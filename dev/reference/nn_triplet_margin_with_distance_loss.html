<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Triplet margin with distance loss — nn_triplet_margin_with_distance_loss • torch</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/united/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet"><meta property="og:title" content="Triplet margin with distance loss — nn_triplet_margin_with_distance_loss"><meta property="og:description" content='Creates a criterion that measures the triplet loss given input
tensors \(a\), \(p\), and \(n\) (representing anchor,
positive, and negative examples, respectively), and a nonnegative,
real-valued function ("distance function") used to compute the relationship
between the anchor and positive example ("positive distance") and the
anchor and negative example ("negative distance").'><meta name="robots" content="noindex"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-178883486-1"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-178883486-1');
</script></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">torch</a>
        <span class="version label label-danger" data-toggle="tooltip" data-placement="bottom" title="In-development version">0.6.1.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/installation.html">Installation</a>
    </li>
    <li class="dropdown-header">Tensors</li>
    <li>
      <a href="../articles/tensor-creation.html">Creating tensors</a>
    </li>
    <li>
      <a href="../articles/indexing.html">Indexing</a>
    </li>
    <li>
      <a href="../articles/tensor/index.html">Tensor class</a>
    </li>
    <li>
      <a href="../articles/serialization.html">Serialization</a>
    </li>
    <li class="dropdown-header">Datasets</li>
    <li>
      <a href="../articles/loading-data.html">Loading Data</a>
    </li>
    <li class="dropdown-header">Autograd</li>
    <li>
      <a href="../articles/using-autograd.html">Using autograd</a>
    </li>
    <li>
      <a href="../articles/extending-autograd.html">Extending autograd</a>
    </li>
    <li>
      <a href="../articles/python-to-r.html">Python models</a>
    </li>
  </ul></li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Examples
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/examples/basic-autograd.html">basic-autograd</a>
    </li>
    <li>
      <a href="../articles/examples/basic-nn-module.html">basic-nn-module</a>
    </li>
    <li>
      <a href="../articles/examples/dataset.html">dataset</a>
    </li>
  </ul></li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/mlverse/torch/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Triplet margin with distance loss</h1>
    <small class="dont-index">Source: <a href="https://github.com/mlverse/torch/blob/HEAD/R/nn-loss.R" class="external-link"><code>R/nn-loss.R</code></a></small>
    <div class="hidden name"><code>nn_triplet_margin_with_distance_loss.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Creates a criterion that measures the triplet loss given input
tensors \(a\), \(p\), and \(n\) (representing anchor,
positive, and negative examples, respectively), and a nonnegative,
real-valued function ("distance function") used to compute the relationship
between the anchor and positive example ("positive distance") and the
anchor and negative example ("negative distance").</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="fu">nn_triplet_margin_with_distance_loss</span><span class="op">(</span>
  distance_function <span class="op">=</span> <span class="cn">NULL</span>,
  margin <span class="op">=</span> <span class="fl">1</span>,
  swap <span class="op">=</span> <span class="cn">FALSE</span>,
  reduction <span class="op">=</span> <span class="st">"mean"</span>
<span class="op">)</span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>distance_function</dt>
<dd><p>(callable, optional): A nonnegative, real-valued function that
quantifies the closeness of two tensors. If not specified,
<code><a href="nn_pairwise_distance.html">nn_pairwise_distance()</a></code> will be used.  Default: <code>None</code></p></dd>
<dt>margin</dt>
<dd><p>(float, optional): A non-negative margin representing the minimum difference
between the positive and negative distances required for the loss to be 0. Larger
margins penalize cases where the negative examples are not distant enough from the
anchors, relative to the positives. Default: \(1\).</p></dd>
<dt>swap</dt>
<dd><p>(bool, optional): Whether to use the distance swap described in the paper
<a href="http://www.bmva.org/bmvc/2016/papers/paper119/index.html" class="external-link">Learning shallow convolutional feature descriptors with triplet losses</a> by
V. Balntas, E. Riba et al. If TRUE, and if the positive example is closer to the
negative example than the anchor is, swaps the positive example and the anchor in
the loss computation. Default: <code>FALSE</code>.</p></dd>
<dt>reduction</dt>
<dd><p>(string, optional): Specifies the (optional) reduction to apply to the output:
<code>'none'</code> | <code>'mean'</code> | <code>'sum'</code>. <code>'none'</code>: no reduction will be applied,
<code>'mean'</code>: the sum of the output will be divided by the number of
elements in the output, <code>'sum'</code>: the output will be summed. Default: <code>'mean'</code></p></dd>
</dl></div>
    <div id="details">
    <h2>Details</h2>
    <p>The unreduced loss (i.e., with <code>reduction</code> set to <code>'none'</code>)
can be described as:</p>
<p>$$
  \ell(a, p, n) = L = \{l_1,\dots,l_N\}^\top, \quad
l_i = \max \{d(a_i, p_i) - d(a_i, n_i) + {\rm margin}, 0\}
$$</p>
<p>where \(N\) is the batch size; \(d\) is a nonnegative, real-valued function
quantifying the closeness of two tensors, referred to as the <code>distance_function</code>;
and \(margin\) is a non-negative margin representing the minimum difference
between the positive and negative distances that is required for the loss to
be 0.  The input tensors have \(N\) elements each and can be of any shape
that the distance function can handle.
If <code>reduction</code> is not <code>'none'</code>
(default <code>'mean'</code>), then:</p>
<p>$$
\ell(x, y) =
\begin{array}{ll}
\mbox{mean}(L), &amp;  \mbox{if reduction} = \mbox{`mean';}\\
            \mbox{sum}(L),  &amp;  \mbox{if reduction} = \mbox{`sum'.}
\end{array}
$$</p>
<p>See also <code><a href="nn_triplet_margin_loss.html">nn_triplet_margin_loss()</a></code>, which computes the triplet
loss for input tensors using the \(l_p\) distance as the distance function.</p>
    </div>
    <div id="shape">
    <h2>Shape</h2>
    

<ul><li><p>Input: \((N, *)\) where \(*\) represents any number of additional dimensions
as supported by the distance function.</p></li>
<li><p>Output: A Tensor of shape \((N)\) if <code>reduction</code> is <code>'none'</code>, or a scalar
otherwise.</p></li>
</ul></div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="torch_is_installed.html">torch_is_installed</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span class="r-in"><span class="co"># Initialize embeddings</span></span>
<span class="r-in"><span class="va">embedding</span> <span class="op">&lt;-</span> <span class="fu"><a href="nn_embedding.html">nn_embedding</a></span><span class="op">(</span><span class="fl">1000</span>, <span class="fl">128</span><span class="op">)</span></span>
<span class="r-in"><span class="va">anchor_ids</span> <span class="op">&lt;-</span> <span class="fu"><a href="torch_randint.html">torch_randint</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1000</span>, <span class="fl">1</span>, dtype <span class="op">=</span> <span class="fu"><a href="torch_dtype.html">torch_long</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span class="r-in"><span class="va">positive_ids</span> <span class="op">&lt;-</span> <span class="fu"><a href="torch_randint.html">torch_randint</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1000</span>, <span class="fl">1</span>, dtype <span class="op">=</span> <span class="fu"><a href="torch_dtype.html">torch_long</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span class="r-in"><span class="va">negative_ids</span> <span class="op">&lt;-</span> <span class="fu"><a href="torch_randint.html">torch_randint</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1000</span>, <span class="fl">1</span>, dtype <span class="op">=</span> <span class="fu"><a href="torch_dtype.html">torch_long</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span class="r-in"><span class="va">anchor</span> <span class="op">&lt;-</span> <span class="fu">embedding</span><span class="op">(</span><span class="va">anchor_ids</span><span class="op">)</span></span>
<span class="r-in"><span class="va">positive</span> <span class="op">&lt;-</span> <span class="fu">embedding</span><span class="op">(</span><span class="va">positive_ids</span><span class="op">)</span></span>
<span class="r-in"><span class="va">negative</span> <span class="op">&lt;-</span> <span class="fu">embedding</span><span class="op">(</span><span class="va">negative_ids</span><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># Built-in Distance Function</span></span>
<span class="r-in"><span class="va">triplet_loss</span> <span class="op">&lt;-</span> <span class="fu">nn_triplet_margin_with_distance_loss</span><span class="op">(</span></span>
<span class="r-in">  distance_function <span class="op">=</span> <span class="fu"><a href="nn_pairwise_distance.html">nn_pairwise_distance</a></span><span class="op">(</span><span class="op">)</span></span>
<span class="r-in"><span class="op">)</span></span>
<span class="r-in"><span class="va">output</span> <span class="op">&lt;-</span> <span class="fu">triplet_loss</span><span class="op">(</span><span class="va">anchor</span>, <span class="va">positive</span>, <span class="va">negative</span><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># Custom Distance Function</span></span>
<span class="r-in"><span class="va">l_infinity</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x1</span>, <span class="va">x2</span><span class="op">)</span> <span class="op">{</span></span>
<span class="r-in">  <span class="fu"><a href="torch_max.html">torch_max</a></span><span class="op">(</span><span class="fu"><a href="torch_abs.html">torch_abs</a></span><span class="op">(</span><span class="va">x1</span> <span class="op">-</span> <span class="va">x2</span><span class="op">)</span>, dim <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span class="r-in"><span class="op">}</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="va">triplet_loss</span> <span class="op">&lt;-</span> <span class="fu">nn_triplet_margin_with_distance_loss</span><span class="op">(</span></span>
<span class="r-in">  distance_function <span class="op">=</span> <span class="va">l_infinity</span>, margin <span class="op">=</span> <span class="fl">1.5</span></span>
<span class="r-in"><span class="op">)</span></span>
<span class="r-in"><span class="va">output</span> <span class="op">&lt;-</span> <span class="fu">triplet_loss</span><span class="op">(</span><span class="va">anchor</span>, <span class="va">positive</span>, <span class="va">negative</span><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># Custom Distance Function (Lambda)</span></span>
<span class="r-in"><span class="va">triplet_loss</span> <span class="op">&lt;-</span> <span class="fu">nn_triplet_margin_with_distance_loss</span><span class="op">(</span></span>
<span class="r-in">  distance_function <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span> <span class="op">{</span></span>
<span class="r-in">    <span class="fl">1</span> <span class="op">-</span> <span class="fu"><a href="nnf_cosine_similarity.html">nnf_cosine_similarity</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span></span>
<span class="r-in">  <span class="op">}</span></span>
<span class="r-in"><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="va">output</span> <span class="op">&lt;-</span> <span class="fu">triplet_loss</span><span class="op">(</span><span class="va">anchor</span>, <span class="va">positive</span>, <span class="va">negative</span><span class="op">)</span></span>
<span class="r-in"><span class="op">}</span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Daniel Falbel, Javier Luraschi.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.2.</p>
</div>

      </footer></div>

  


  

  </body></html>

