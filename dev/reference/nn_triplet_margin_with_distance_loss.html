<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Triplet margin with distance loss — nn_triplet_margin_with_distance_loss • torch</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet"><meta property="og:title" content="Triplet margin with distance loss — nn_triplet_margin_with_distance_loss"><meta name="description" content='Creates a criterion that measures the triplet loss given input
tensors \(a\), \(p\), and \(n\) (representing anchor,
positive, and negative examples, respectively), and a nonnegative,
real-valued function ("distance function") used to compute the relationship
between the anchor and positive example ("positive distance") and the
anchor and negative example ("negative distance").'><meta property="og:description" content='Creates a criterion that measures the triplet loss given input
tensors \(a\), \(p\), and \(n\) (representing anchor,
positive, and negative examples, respectively), and a nonnegative,
real-valued function ("distance function") used to compute the relationship
between the anchor and positive example ("positive distance") and the
anchor and negative example ("negative distance").'><meta name="robots" content="noindex"><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=G-9ZJSKW3L0N"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-9ZJSKW3L0N');
</script></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">torch</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">0.13.0.9001</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/installation.html">Installation</a></li>
    <li><h6 class="dropdown-header" data-toc-skip>Tensors</h6></li>
    <li><a class="dropdown-item" href="../articles/tensor-creation.html">Creating tensors</a></li>
    <li><a class="dropdown-item" href="../articles/indexing.html">Indexing</a></li>
    <li><a class="dropdown-item" href="../articles/tensor/index.html">Tensor class</a></li>
    <li><a class="dropdown-item" href="../articles/serialization.html">Serialization</a></li>
    <li><h6 class="dropdown-header" data-toc-skip>Datasets</h6></li>
    <li><a class="dropdown-item" href="../articles/loading-data.html">Loading Data</a></li>
    <li><h6 class="dropdown-header" data-toc-skip>Autograd</h6></li>
    <li><a class="dropdown-item" href="../articles/using-autograd.html">Using autograd</a></li>
    <li><a class="dropdown-item" href="../articles/extending-autograd.html">Extending autograd</a></li>
    <li><a class="dropdown-item" href="../articles/python-to-r.html">Python models</a></li>
    <li><a class="dropdown-item" href="../articles/torchscript.html">Jit Compilation</a></li>
  </ul></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-examples" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Examples</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-examples"><li><a class="dropdown-item" href="../articles/examples/basic-autograd.html">basic-autograd</a></li>
    <li><a class="dropdown-item" href="../articles/examples/basic-nn-module.html">basic-nn-module</a></li>
    <li><a class="dropdown-item" href="../articles/examples/dataset.html">dataset</a></li>
  </ul></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-advanced" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Advanced</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-advanced"><li><a class="dropdown-item" href="../articles/memory-management.html">Memory management</a></li>
    <li><a class="dropdown-item" href="../articles/modifying-source-code.html">Building locally</a></li>
    <li><a class="dropdown-item" href="../articles/amp.html">Automatic Mixed Precision</a></li>
  </ul></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><a class="external-link nav-link" href="https://github.com/mlverse/torch/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Triplet margin with distance loss</h1>
      <small class="dont-index">Source: <a href="https://github.com/mlverse/torch/blob/main/R/nn-loss.R" class="external-link"><code>R/nn-loss.R</code></a></small>
      <div class="d-none name"><code>nn_triplet_margin_with_distance_loss.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Creates a criterion that measures the triplet loss given input
tensors \(a\), \(p\), and \(n\) (representing anchor,
positive, and negative examples, respectively), and a nonnegative,
real-valued function ("distance function") used to compute the relationship
between the anchor and positive example ("positive distance") and the
anchor and negative example ("negative distance").</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">nn_triplet_margin_with_distance_loss</span><span class="op">(</span></span>
<span>  distance_function <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  margin <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  swap <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  reduction <span class="op">=</span> <span class="st">"mean"</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-distance-function">distance_function<a class="anchor" aria-label="anchor" href="#arg-distance-function"></a></dt>
<dd><p>(callable, optional): A nonnegative, real-valued function that
quantifies the closeness of two tensors. If not specified,
<code><a href="nn_pairwise_distance.html">nn_pairwise_distance()</a></code> will be used.  Default: <code>None</code></p></dd>


<dt id="arg-margin">margin<a class="anchor" aria-label="anchor" href="#arg-margin"></a></dt>
<dd><p>(float, optional): A non-negative margin representing the minimum difference
between the positive and negative distances required for the loss to be 0. Larger
margins penalize cases where the negative examples are not distant enough from the
anchors, relative to the positives. Default: \(1\).</p></dd>


<dt id="arg-swap">swap<a class="anchor" aria-label="anchor" href="#arg-swap"></a></dt>
<dd><p>(bool, optional): Whether to use the distance swap described in the paper
<a href="https://paperswithcode.com/paper/learning-local-feature-descriptors-with" class="external-link">Learning shallow convolutional feature descriptors with triplet losses</a> by
V. Balntas, E. Riba et al. If TRUE, and if the positive example is closer to the
negative example than the anchor is, swaps the positive example and the anchor in
the loss computation. Default: <code>FALSE</code>.</p></dd>


<dt id="arg-reduction">reduction<a class="anchor" aria-label="anchor" href="#arg-reduction"></a></dt>
<dd><p>(string, optional): Specifies the (optional) reduction to apply to the output:
<code>'none'</code> | <code>'mean'</code> | <code>'sum'</code>. <code>'none'</code>: no reduction will be applied,
<code>'mean'</code>: the sum of the output will be divided by the number of
elements in the output, <code>'sum'</code>: the output will be summed. Default: <code>'mean'</code></p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>The unreduced loss (i.e., with <code>reduction</code> set to <code>'none'</code>)
can be described as:</p>
<p>$$
  \ell(a, p, n) = L = \{l_1,\dots,l_N\}^\top, \quad
l_i = \max \{d(a_i, p_i) - d(a_i, n_i) + {\rm margin}, 0\}
$$</p>
<p>where \(N\) is the batch size; \(d\) is a nonnegative, real-valued function
quantifying the closeness of two tensors, referred to as the <code>distance_function</code>;
and \(margin\) is a non-negative margin representing the minimum difference
between the positive and negative distances that is required for the loss to
be 0.  The input tensors have \(N\) elements each and can be of any shape
that the distance function can handle.
If <code>reduction</code> is not <code>'none'</code>
(default <code>'mean'</code>), then:</p>
<p>$$
\ell(x, y) =
\begin{array}{ll}
\mbox{mean}(L), &amp;  \mbox{if reduction} = \mbox{`mean';}\\
            \mbox{sum}(L),  &amp;  \mbox{if reduction} = \mbox{`sum'.}
\end{array}
$$</p>
<p>See also <code><a href="nn_triplet_margin_loss.html">nn_triplet_margin_loss()</a></code>, which computes the triplet
loss for input tensors using the \(l_p\) distance as the distance function.</p>
    </div>
    <div class="section level2">
    <h2 id="shape">Shape<a class="anchor" aria-label="anchor" href="#shape"></a></h2>


<ul><li><p>Input: \((N, *)\) where \(*\) represents any number of additional dimensions
as supported by the distance function.</p></li>
<li><p>Output: A Tensor of shape \((N)\) if <code>reduction</code> is <code>'none'</code>, or a scalar
otherwise.</p></li>
</ul></div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="torch_is_installed.html">torch_is_installed</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span><span class="co"># Initialize embeddings</span></span></span>
<span class="r-in"><span><span class="va">embedding</span> <span class="op">&lt;-</span> <span class="fu"><a href="nn_embedding.html">nn_embedding</a></span><span class="op">(</span><span class="fl">1000</span>, <span class="fl">128</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">anchor_ids</span> <span class="op">&lt;-</span> <span class="fu"><a href="torch_randint.html">torch_randint</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1000</span>, <span class="fl">1</span>, dtype <span class="op">=</span> <span class="fu"><a href="torch_dtype.html">torch_long</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">positive_ids</span> <span class="op">&lt;-</span> <span class="fu"><a href="torch_randint.html">torch_randint</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1000</span>, <span class="fl">1</span>, dtype <span class="op">=</span> <span class="fu"><a href="torch_dtype.html">torch_long</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">negative_ids</span> <span class="op">&lt;-</span> <span class="fu"><a href="torch_randint.html">torch_randint</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1000</span>, <span class="fl">1</span>, dtype <span class="op">=</span> <span class="fu"><a href="torch_dtype.html">torch_long</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">anchor</span> <span class="op">&lt;-</span> <span class="fu">embedding</span><span class="op">(</span><span class="va">anchor_ids</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">positive</span> <span class="op">&lt;-</span> <span class="fu">embedding</span><span class="op">(</span><span class="va">positive_ids</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">negative</span> <span class="op">&lt;-</span> <span class="fu">embedding</span><span class="op">(</span><span class="va">negative_ids</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Built-in Distance Function</span></span></span>
<span class="r-in"><span><span class="va">triplet_loss</span> <span class="op">&lt;-</span> <span class="fu">nn_triplet_margin_with_distance_loss</span><span class="op">(</span></span></span>
<span class="r-in"><span>  distance_function <span class="op">=</span> <span class="fu"><a href="nn_pairwise_distance.html">nn_pairwise_distance</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">output</span> <span class="op">&lt;-</span> <span class="fu">triplet_loss</span><span class="op">(</span><span class="va">anchor</span>, <span class="va">positive</span>, <span class="va">negative</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Custom Distance Function</span></span></span>
<span class="r-in"><span><span class="va">l_infinity</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x1</span>, <span class="va">x2</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="torch_max.html">torch_max</a></span><span class="op">(</span><span class="fu"><a href="torch_abs.html">torch_abs</a></span><span class="op">(</span><span class="va">x1</span> <span class="op">-</span> <span class="va">x2</span><span class="op">)</span>, dim <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">triplet_loss</span> <span class="op">&lt;-</span> <span class="fu">nn_triplet_margin_with_distance_loss</span><span class="op">(</span></span></span>
<span class="r-in"><span>  distance_function <span class="op">=</span> <span class="va">l_infinity</span>, margin <span class="op">=</span> <span class="fl">1.5</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">output</span> <span class="op">&lt;-</span> <span class="fu">triplet_loss</span><span class="op">(</span><span class="va">anchor</span>, <span class="va">positive</span>, <span class="va">negative</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Custom Distance Function (Lambda)</span></span></span>
<span class="r-in"><span><span class="va">triplet_loss</span> <span class="op">&lt;-</span> <span class="fu">nn_triplet_margin_with_distance_loss</span><span class="op">(</span></span></span>
<span class="r-in"><span>  distance_function <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>    <span class="fl">1</span> <span class="op">-</span> <span class="fu"><a href="nnf_cosine_similarity.html">nnf_cosine_similarity</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">}</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">output</span> <span class="op">&lt;-</span> <span class="fu">triplet_loss</span><span class="op">(</span><span class="va">anchor</span>, <span class="va">positive</span>, <span class="va">negative</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Daniel Falbel, Javier Luraschi.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer></div>





  </body></html>

