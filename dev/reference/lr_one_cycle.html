<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Once cycle learning rate — lr_one_cycle • torch</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/united/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous" />


<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>



  <link href="../extra.css" rel="stylesheet">
  

<meta property="og:title" content="Once cycle learning rate — lr_one_cycle" />
<meta property="og:description" content="Sets the learning rate of each parameter group according to the
1cycle learning rate policy. The 1cycle policy anneals the learning
rate from an initial learning rate to some maximum learning rate and then
from that maximum learning rate to some minimum learning rate much lower
than the initial learning rate." />


<meta name="robots" content="noindex">

<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->


<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-178883486-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-178883486-1');
</script>


  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">torch</a>
        <span class="version label label-danger" data-toggle="tooltip" data-placement="bottom" title="In-development version">0.1.1.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Getting started
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li class="dropdown-header">Beginers guide</li>
    <li>
      <a href="../articles/getting-started/warmup.html">Warm-up</a>
    </li>
    <li>
      <a href="../articles/getting-started/tensors.html">Tensors</a>
    </li>
    <li>
      <a href="../articles/getting-started/tensors-and-autograd.html">Tensors and autograd</a>
    </li>
    <li>
      <a href="../articles/getting-started/new-autograd-functions.html">Defining new autograd functions</a>
    </li>
    <li>
      <a href="../articles/getting-started/nn.html">nn: neural networks with torch</a>
    </li>
    <li>
      <a href="../articles/getting-started/optim.html">optim: optimizers in torch</a>
    </li>
    <li>
      <a href="../articles/getting-started/custom-nn.html">Custom nn modules</a>
    </li>
    <li>
      <a href="../articles/getting-started/control-flow-and-weight-sharing.html">Control flow &amp; Weight sharing</a>
    </li>
    <li class="dropdown-header">Torch Mechanics</li>
    <li>
      <a href="../articles/getting-started/what-is-torch.html">What's torch?</a>
    </li>
    <li>
      <a href="../articles/getting-started/autograd.html">Autograd: automatic differentiation</a>
    </li>
    <li>
      <a href="../articles/getting-started/neural-networks.html">Neural networks</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/installation.html">Installation</a>
    </li>
    <li class="dropdown-header">Tensors</li>
    <li>
      <a href="../articles/tensor-creation.html">Creating tensors</a>
    </li>
    <li>
      <a href="../articles/indexing.html">Indexing</a>
    </li>
    <li>
      <a href="../articles/tensor/index.html">Tensor class</a>
    </li>
    <li>
      <a href="../articles/serialization.html">Serialization</a>
    </li>
    <li class="dropdown-header">Datasets</li>
    <li>
      <a href="../articles/loading-data.html">Loading Data</a>
    </li>
    <li class="dropdown-header">Autograd</li>
    <li>
      <a href="../articles/using-autograd.html">Using autograd</a>
    </li>
    <li>
      <a href="../articles/extending-autograd.html">Extending autograd</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Examples
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/examples/basic-autograd.html">basic-autograd</a>
    </li>
    <li>
      <a href="../articles/examples/basic-nn-module.html">basic-nn-module</a>
    </li>
    <li>
      <a href="../articles/examples/dataset.html">dataset</a>
    </li>
  </ul>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/mlverse/torch/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Once cycle learning rate</h1>
    <small class="dont-index">Source: <a href='https://github.com/mlverse/torch/blob/master/R/optim-lr_scheduler.R'><code>R/optim-lr_scheduler.R</code></a></small>
    <div class="hidden name"><code>lr_one_cycle.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Sets the learning rate of each parameter group according to the
1cycle learning rate policy. The 1cycle policy anneals the learning
rate from an initial learning rate to some maximum learning rate and then
from that maximum learning rate to some minimum learning rate much lower
than the initial learning rate.</p>
    </div>

    <pre class="usage"><span class='fu'>lr_one_cycle</span><span class='op'>(</span>
  <span class='va'>optimizer</span>,
  <span class='va'>max_lr</span>,
  total_steps <span class='op'>=</span> <span class='cn'>NULL</span>,
  epochs <span class='op'>=</span> <span class='cn'>NULL</span>,
  steps_per_epoch <span class='op'>=</span> <span class='cn'>NULL</span>,
  pct_start <span class='op'>=</span> <span class='fl'>0.3</span>,
  anneal_strategy <span class='op'>=</span> <span class='st'>"cos"</span>,
  cycle_momentum <span class='op'>=</span> <span class='cn'>TRUE</span>,
  base_momentum <span class='op'>=</span> <span class='fl'>0.85</span>,
  max_momentum <span class='op'>=</span> <span class='fl'>0.95</span>,
  div_factor <span class='op'>=</span> <span class='fl'>25</span>,
  final_div_factor <span class='op'>=</span> <span class='fl'>10000</span>,
  last_epoch <span class='op'>=</span> <span class='op'>-</span><span class='fl'>1</span>,
  verbose <span class='op'>=</span> <span class='cn'>FALSE</span>
<span class='op'>)</span></pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>optimizer</th>
      <td><p>(Optimizer): Wrapped optimizer.</p></td>
    </tr>
    <tr>
      <th>max_lr</th>
      <td><p>(float or list): Upper learning rate boundaries in the cycle
for each parameter group.</p></td>
    </tr>
    <tr>
      <th>total_steps</th>
      <td><p>(int): The total number of steps in the cycle. Note that
if a value is not provided here, then it must be inferred by providing
a value for epochs and steps_per_epoch.
Default: NULL</p></td>
    </tr>
    <tr>
      <th>epochs</th>
      <td><p>(int): The number of epochs to train for. This is used along
with steps_per_epoch in order to infer the total number of steps in the cycle
if a value for total_steps is not provided.
Default: NULL</p></td>
    </tr>
    <tr>
      <th>steps_per_epoch</th>
      <td><p>(int): The number of steps per epoch to train for. This is
used along with epochs in order to infer the total number of steps in the
cycle if a value for total_steps is not provided.
Default: NULL</p></td>
    </tr>
    <tr>
      <th>pct_start</th>
      <td><p>(float): The percentage of the cycle (in number of steps) spent
increasing the learning rate.
Default: 0.3</p></td>
    </tr>
    <tr>
      <th>anneal_strategy</th>
      <td><p>(str): 'cos', 'linear'
Specifies the annealing strategy: "cos" for cosine annealing, "linear" for
linear annealing.
Default: 'cos'</p></td>
    </tr>
    <tr>
      <th>cycle_momentum</th>
      <td><p>(bool): If <code>TRUE</code>, momentum is cycled inversely
to learning rate between 'base_momentum' and 'max_momentum'.
Default: TRUE</p></td>
    </tr>
    <tr>
      <th>base_momentum</th>
      <td><p>(float or list): Lower momentum boundaries in the cycle
for each parameter group. Note that momentum is cycled inversely
to learning rate; at the peak of a cycle, momentum is
'base_momentum' and learning rate is 'max_lr'.
Default: 0.85</p></td>
    </tr>
    <tr>
      <th>max_momentum</th>
      <td><p>(float or list): Upper momentum boundaries in the cycle
for each parameter group. Functionally,
it defines the cycle amplitude (max_momentum - base_momentum).
Note that momentum is cycled inversely
to learning rate; at the start of a cycle, momentum is 'max_momentum'
and learning rate is 'base_lr'
Default: 0.95</p></td>
    </tr>
    <tr>
      <th>div_factor</th>
      <td><p>(float): Determines the initial learning rate via
initial_lr = max_lr/div_factor
Default: 25</p></td>
    </tr>
    <tr>
      <th>final_div_factor</th>
      <td><p>(float): Determines the minimum learning rate via
min_lr = initial_lr/final_div_factor
Default: 1e4</p></td>
    </tr>
    <tr>
      <th>last_epoch</th>
      <td><p>(int): The index of the last batch. This parameter is used when
resuming a training job. Since <code><a href='https://rdrr.io/r/stats/step.html'>step()</a></code> should be invoked after each
batch instead of after each epoch, this number represents the total
number of <em>batches</em> computed, not the total number of epochs computed.
When last_epoch=-1, the schedule is started from the beginning.
Default: -1</p></td>
    </tr>
    <tr>
      <th>verbose</th>
      <td><p>(bool): If <code>TRUE</code>, prints a message to stdout for
each update. Default: <code>FALSE</code>.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>This policy was initially described in the paper
<a href='https://arxiv.org/abs/1708.07120'>Super-Convergence: Very Fast Training of Neural Networks Using Large Learning Rates</a>.</p>
<p>The 1cycle learning rate policy changes the learning rate after every batch.
<code>step</code> should be called after a batch has been used for training.
This scheduler is not chainable.</p>
<p>Note also that the total number of steps in the cycle can be determined in one
of two ways (listed in order of precedence):</p><ul>
<li><p>A value for total_steps is explicitly provided.</p></li>
<li><p>A number of epochs (epochs) and a number of steps per epoch
(steps_per_epoch) are provided.</p></li>
</ul>

<p>In this case, the number of total steps is inferred by
total_steps = epochs * steps_per_epoch</p>
<p>You must either provide a value for total_steps or provide a value for both
epochs and steps_per_epoch.</p>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='kw'>if</span> <span class='op'>(</span><span class='fu'><a href='torch_is_installed.html'>torch_is_installed</a></span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>{</span>
<span class='kw'>if</span> <span class='op'>(</span><span class='cn'>FALSE</span><span class='op'>)</span> <span class='op'>{</span>
<span class='va'>data_loader</span> <span class='op'>&lt;-</span> <span class='fu'><a href='dataloader.html'>dataloader</a></span><span class='op'>(</span><span class='va'>...</span><span class='op'>)</span>
<span class='va'>optimizer</span> <span class='op'>&lt;-</span> <span class='fu'><a href='optim_sgd.html'>optim_sgd</a></span><span class='op'>(</span><span class='va'>model</span><span class='op'>$</span><span class='va'>parameters</span>, lr<span class='op'>=</span><span class='fl'>0.1</span>, momentum<span class='op'>=</span><span class='fl'>0.9</span><span class='op'>)</span>
<span class='va'>scheduler</span> <span class='op'>&lt;-</span> <span class='fu'>lr_one_cycle</span><span class='op'>(</span><span class='va'>optimizer</span>, max_lr<span class='op'>=</span><span class='fl'>0.01</span>, steps_per_epoch<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/length.html'>length</a></span><span class='op'>(</span><span class='va'>data_loader</span><span class='op'>)</span>, 
                          epochs<span class='op'>=</span><span class='fl'>10</span><span class='op'>)</span>

<span class='kw'>for</span> <span class='op'>(</span><span class='va'>i</span> <span class='kw'>in</span> <span class='fl'>1</span><span class='op'>:</span><span class='va'>epochs</span><span class='op'>)</span> <span class='op'>{</span>
  <span class='kw'>for</span> <span class='op'>(</span><span class='va'>batch</span> <span class='kw'>in</span> <span class='fu'><a href='enumerate.html'>enumerate</a></span><span class='op'>(</span><span class='va'>data_loader</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>{</span>
     <span class='fu'>train_batch</span><span class='op'>(</span><span class='va'>...</span><span class='op'>)</span>
     <span class='va'>scheduler</span><span class='op'>$</span><span class='fu'>step</span><span class='op'>(</span><span class='op'>)</span>
  <span class='op'>}</span>
<span class='op'>}</span>
<span class='op'>}</span>

<span class='op'>}</span>
</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Daniel Falbel, Javier Luraschi.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


