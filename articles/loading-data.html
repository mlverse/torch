<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Loading data • torch</title>
<!-- mathjax math --><script src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script><script>
  window.MathJax = {
    chtml: {
      fontURL: "https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/output/chtml/fonts/woff-v2"
    }
  };
</script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Loading data">
<!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=G-9ZJSKW3L0N"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-9ZJSKW3L0N');
</script>
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">torch</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">0.16.3</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/installation.html">Installation</a></li>
    <li><h6 class="dropdown-header" data-toc-skip>Tensors</h6></li>
    <li><a class="dropdown-item" href="../articles/tensor-creation.html">Creating tensors</a></li>
    <li><a class="dropdown-item" href="../articles/indexing.html">Indexing</a></li>
    <li><a class="dropdown-item" href="../articles/tensor/index.html">Tensor class</a></li>
    <li><a class="dropdown-item" href="../articles/serialization.html">Serialization</a></li>
    <li><h6 class="dropdown-header" data-toc-skip>Datasets</h6></li>
    <li><a class="dropdown-item" href="../articles/loading-data.html">Loading Data</a></li>
    <li><h6 class="dropdown-header" data-toc-skip>Autograd</h6></li>
    <li><a class="dropdown-item" href="../articles/using-autograd.html">Using autograd</a></li>
    <li><a class="dropdown-item" href="../articles/extending-autograd.html">Extending autograd</a></li>
    <li><a class="dropdown-item" href="../articles/python-to-r.html">Python models</a></li>
    <li><a class="dropdown-item" href="../articles/torchscript.html">Jit Compilation</a></li>
  </ul>
</li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-examples" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Examples</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-examples">
<li><a class="dropdown-item" href="../articles/examples/basic-autograd.html">basic-autograd</a></li>
    <li><a class="dropdown-item" href="../articles/examples/basic-nn-module.html">basic-nn-module</a></li>
    <li><a class="dropdown-item" href="../articles/examples/dataset.html">dataset</a></li>
  </ul>
</li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-advanced" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Advanced</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-advanced">
<li><a class="dropdown-item" href="../articles/memory-management.html">Memory management</a></li>
    <li><a class="dropdown-item" href="../articles/modifying-source-code.html">Building locally</a></li>
    <li><a class="dropdown-item" href="../articles/amp.html">Automatic Mixed Precision</a></li>
    <li><a class="dropdown-item" href="../articles/modifying-source-code.html">Modifying source code</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/mlverse/torch/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Loading data</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/mlverse/torch/blob/main/vignettes/loading-data.Rmd" class="external-link"><code>vignettes/loading-data.Rmd</code></a></small>
      <div class="d-none name"><code>loading-data.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://torch.mlverse.org/docs">torch</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="datasets-and-data-loaders">Datasets and data loaders<a class="anchor" aria-label="anchor" href="#datasets-and-data-loaders"></a>
</h2>
<p>Central to data ingestion and preprocessing are datasets and data
loaders. A dataset is an object that holds the data to use, while a data
loader is an object that will load the data from a dataset providing a
way to access subsets of the data. By using datasets and data loaders
you will have a process for clearly organizing your data and passing it
to other components of the torch package, such as model training.</p>
<p>Built into <code>torch</code> are premade datasets that are commonly
used in machine learning, such as the MNIST handwriting dataset
(<code>mnist_dataset()</code>). Most of the prebuilt datasets relate to
image recognition and natural language processing.</p>
<p>Below is an example of how you would use the MNIST dataset with a
dataloader. First, the <code>minst_dataset()</code> function is used to
create <code>ds</code> which is a <code>Dataset</code> object. Then a
dataloader <code>dl</code> is created to query that data. Finally, that
dataloader is used in a <code><a href="https://coro.r-lib.org/reference/collect.html" class="external-link">coro::loop()</a></code> to iterate over
batches of that data:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="co"># Create a dataset from included data</span></span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a>ds <span class="ot">&lt;-</span> <span class="fu">mnist_dataset</span>(</span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a>  dir, </span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a>  <span class="at">download =</span> <span class="cn">TRUE</span>, </span>
<span id="cb2-5"><a href="#cb2-5" tabindex="-1"></a>  <span class="at">transform =</span> <span class="cf">function</span>(x) {</span>
<span id="cb2-6"><a href="#cb2-6" tabindex="-1"></a>    x <span class="ot">&lt;-</span> x<span class="sc">$</span><span class="fu">to</span>(<span class="at">dtype =</span> <span class="fu">torch_float</span>())<span class="sc">/</span><span class="dv">256</span></span>
<span id="cb2-7"><a href="#cb2-7" tabindex="-1"></a>    x[newaxis,..]</span>
<span id="cb2-8"><a href="#cb2-8" tabindex="-1"></a>  }</span>
<span id="cb2-9"><a href="#cb2-9" tabindex="-1"></a>)</span>
<span id="cb2-10"><a href="#cb2-10" tabindex="-1"></a></span>
<span id="cb2-11"><a href="#cb2-11" tabindex="-1"></a><span class="co"># Create the loader to query the data in batches</span></span>
<span id="cb2-12"><a href="#cb2-12" tabindex="-1"></a>dl <span class="ot">&lt;-</span> <span class="fu">dataloader</span>(ds, <span class="at">batch_size =</span> <span class="dv">32</span>, <span class="at">shuffle =</span> <span class="cn">TRUE</span>)</span>
<span id="cb2-13"><a href="#cb2-13" tabindex="-1"></a></span>
<span id="cb2-14"><a href="#cb2-14" tabindex="-1"></a>coro<span class="sc">::</span><span class="fu">loop</span>(<span class="cf">for</span> (b <span class="cf">in</span> dl)) {</span>
<span id="cb2-15"><a href="#cb2-15" tabindex="-1"></a><span class="co"># use the data from each batch `b` here</span></span>
<span id="cb2-16"><a href="#cb2-16" tabindex="-1"></a><span class="co"># ...</span></span>
<span id="cb2-17"><a href="#cb2-17" tabindex="-1"></a>}<span class="er">)</span></span></code></pre></div>
<p>See <code>vignettes/examples/mnist-cnn.R</code> for a complete
example.</p>
<p>In the more common situation where you have a unique set of data that
isn’t included with the package you’ll need to make a custom
<code>Dataset</code> subclass by using the <code><a href="../reference/dataset.html">dataset()</a></code>
function. The custom <code>Dataset</code> subclass is an abstract R6
container for the data. It will need to know some information about the
particular dataset, such as how to iterate over it.</p>
<p>At a minimum, when using <code><a href="../reference/dataset.html">dataset()</a></code> to create a custom
<code>Dataset</code> class you’ll want to define the following:</p>
<ul>
<li>
<code>name</code> - for convenience, keep track of what type of data
it is</li>
<li>
<code>initialize</code> - a member function defining how to create a
object with that class. It could have no parameters, for when all
objects of that class will be the same, or you can give it specific
parameters usually for if different objects should have different
data.</li>
<li>
<code>.getitem</code> - this member function is called when the
dataloader goes to pull a new batch of data. You can include
preprocessing in this function if needed. Note that the function will be
called extremely frequently, so it’s advantageous to make it fast.</li>
<li>
<code>.length</code> - this will return the amount of data in the
dataset, which is helpful for users.</li>
</ul>
</div>
<div class="section level2">
<h2 id="example-of-using-a-custom-dataset">Example of using a custom Dataset<a class="anchor" aria-label="anchor" href="#example-of-using-a-custom-dataset"></a>
</h2>
<p>While this may sound complicated the base logic is only a few
steps–the complexity often comes from the data itself and how involved
your preprocessing is. Here we show how to create your own
<code>Dataset</code> class to train on <a href="https://github.com/allisonhorst/palmerpenguins" class="external-link">Allison Horst's
penguins</a>.</p>
<table style="width:100%;" class="table">
<colgroup>
<col width="16%">
<col width="35%">
<col width="16%">
<col width="16%">
<col width="16%">
</colgroup>
<thead><tr class="header">
<th align="left">Component</th>
<th align="center">
<code>Dataset</code> R6 class</th>
<th align="center">
<code>Dataset</code> object</th>
<th align="center">
<code>DataLoader</code> object</th>
<th align="center">batch</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Description</td>
<td align="center">Output of <code><a href="../reference/dataset.html">dataset()</a></code>. When calling
<code><a href="../reference/dataset.html">dataset()</a></code> it should have at least a <code>name</code>,
<code>initialize</code>, <code>.getitem</code>, and
<code>.length</code>. Output is a <code>Dataset</code> generator.</td>
<td align="center">Object created by using the custom
<code>Dataset</code> generator. Actually stores the data</td>
<td align="center">Object that queries the <code>Dataset</code> object
to pull batches of data</td>
<td align="center">The subsample of data used for things like model
training</td>
</tr>
<tr class="even">
<td align="left">Penguin example</td>
<td align="center"><code>penguins_dataset</code></td>
<td align="center"><code>tuxes</code></td>
<td align="center"><code>dl</code></td>
<td align="center"><code>b</code></td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://allisonhorst.github.io/palmerpenguins/" class="external-link">palmerpenguins</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'palmerpenguins'</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:datasets':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     penguins, penguins_raw</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://magrittr.tidyverse.org" class="external-link">magrittr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">penguins</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 344 × 8</span></span></span>
<span><span class="co">#&gt;    species island    bill_length_mm bill_depth_mm flipper_length_mm body_mass_g</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>              <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>             <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> Adelie  Torgersen           39.1          18.7               181        <span style="text-decoration: underline;">3</span>750</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> Adelie  Torgersen           39.5          17.4               186        <span style="text-decoration: underline;">3</span>800</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> Adelie  Torgersen           40.3          18                 195        <span style="text-decoration: underline;">3</span>250</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> Adelie  Torgersen           <span style="color: #BB0000;">NA</span>            <span style="color: #BB0000;">NA</span>                  <span style="color: #BB0000;">NA</span>          <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> Adelie  Torgersen           36.7          19.3               193        <span style="text-decoration: underline;">3</span>450</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> Adelie  Torgersen           39.3          20.6               190        <span style="text-decoration: underline;">3</span>650</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> Adelie  Torgersen           38.9          17.8               181        <span style="text-decoration: underline;">3</span>625</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> Adelie  Torgersen           39.2          19.6               195        <span style="text-decoration: underline;">4</span>675</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> Adelie  Torgersen           34.1          18.1               193        <span style="text-decoration: underline;">3</span>475</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> Adelie  Torgersen           42            20.2               190        <span style="text-decoration: underline;">4</span>250</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 334 more rows</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 2 more variables: sex &lt;fct&gt;, year &lt;int&gt;</span></span></span></code></pre></div>
<p>In addition, any number of helper functions can be defined.</p>
<p>Here, we assume the <code>penguins</code> have already been loaded,
and all preprocessing consists in removing lines with <code>NA</code>
values, transforming <code>factor</code>s to numbers starting from 0,
and converting from R data types to <code>torch</code> tensors.</p>
<p>In <code>.getitem</code>, we essentially decide how this data is
going to be used: All variables besides <code>species</code> go into
<code>x</code>, the predictor, and <code>species</code> will constitute
<code>y</code>, the target. Predictor and target are returned in a list,
to be accessed as <code>batch[[1]]</code> and <code>batch[[2]]</code>
during training.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">penguins_dataset</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/dataset.html">dataset</a></span><span class="op">(</span></span>
<span>  </span>
<span>  name <span class="op">=</span> <span class="st">"penguins_dataset"</span>,</span>
<span>  </span>
<span>  initialize <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">self</span><span class="op">$</span><span class="va">data</span> <span class="op">&lt;-</span> <span class="va">self</span><span class="op">$</span><span class="fu">prepare_penguin_data</span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="op">}</span>,</span>
<span>  </span>
<span>  .getitem <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">index</span><span class="op">)</span> <span class="op">{</span></span>
<span>    </span>
<span>    <span class="va">x</span> <span class="op">&lt;-</span> <span class="va">self</span><span class="op">$</span><span class="va">data</span><span class="op">[</span><span class="va">index</span>, <span class="fl">2</span><span class="op">:</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span></span>
<span>    <span class="va">y</span> <span class="op">&lt;-</span> <span class="va">self</span><span class="op">$</span><span class="va">data</span><span class="op">[</span><span class="va">index</span>, <span class="fl">1</span><span class="op">]</span><span class="op">$</span><span class="fu">to</span><span class="op">(</span><span class="fu"><a href="../reference/torch_dtype.html">torch_long</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span></span>
<span>  <span class="op">}</span>,</span>
<span>  </span>
<span>  .length <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">self</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="fu">size</span><span class="op">(</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span>  <span class="op">}</span>,</span>
<span>  </span>
<span>  prepare_penguin_data <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span>
<span>    </span>
<span>    <span class="va">input</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/na.fail.html" class="external-link">na.omit</a></span><span class="op">(</span><span class="va">penguins</span><span class="op">)</span> </span>
<span>    <span class="co"># conveniently, the categorical data are already factors</span></span>
<span>    <span class="va">input</span><span class="op">$</span><span class="va">species</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">species</span><span class="op">)</span></span>
<span>    <span class="va">input</span><span class="op">$</span><span class="va">island</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">island</span><span class="op">)</span></span>
<span>    <span class="va">input</span><span class="op">$</span><span class="va">sex</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">sex</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="va">input</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">input</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="../reference/torch_tensor.html">torch_tensor</a></span><span class="op">(</span><span class="va">input</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Let’s create the dataset , query for it’s length, and look at its
first item:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tuxes</span> <span class="op">&lt;-</span> <span class="fu">penguins_dataset</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">tuxes</span><span class="op">$</span><span class="fu">.length</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 333</span></span>
<span><span class="va">tuxes</span><span class="op">$</span><span class="fu">.getitem</span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="co">#&gt; [[1]]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt;     3.0000</span></span>
<span><span class="co">#&gt;    39.1000</span></span>
<span><span class="co">#&gt;    18.7000</span></span>
<span><span class="co">#&gt;   181.0000</span></span>
<span><span class="co">#&gt;  3750.0000</span></span>
<span><span class="co">#&gt;     2.0000</span></span>
<span><span class="co">#&gt;  2007.0000</span></span>
<span><span class="co">#&gt; [ CPUFloatType{7} ]</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[2]]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 1</span></span>
<span><span class="co">#&gt; [ CPULongType{} ]</span></span></code></pre></div>
<p>To be able to iterate over <code>tuxes</code>, we need a data loader
(we override the default batch size of <code>1</code>):</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dl</span> <span class="op">&lt;-</span> <span class="va">tuxes</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="../reference/dataloader.html">dataloader</a></span><span class="op">(</span>batch_size <span class="op">=</span> <span class="fl">8</span><span class="op">)</span></span></code></pre></div>
<p>Calling <code>.length()</code> on a data loader (as opposed to a
dataset) will return the number of <code>batches</code> we have:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dl</span><span class="op">$</span><span class="fu">.length</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 42</span></span></code></pre></div>
<p>And we can create an iterator to inspect the first batch:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">iter</span> <span class="op">&lt;-</span> <span class="va">dl</span><span class="op">$</span><span class="fu">.iter</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">b</span> <span class="op">&lt;-</span> <span class="va">iter</span><span class="op">$</span><span class="fu">.next</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">b</span></span>
<span><span class="co">#&gt; [[1]]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt;     3.0000    39.1000    18.7000   181.0000  3750.0000     2.0000  2007.0000</span></span>
<span><span class="co">#&gt;     3.0000    39.5000    17.4000   186.0000  3800.0000     1.0000  2007.0000</span></span>
<span><span class="co">#&gt;     3.0000    40.3000    18.0000   195.0000  3250.0000     1.0000  2007.0000</span></span>
<span><span class="co">#&gt;     3.0000    36.7000    19.3000   193.0000  3450.0000     1.0000  2007.0000</span></span>
<span><span class="co">#&gt;     3.0000    39.3000    20.6000   190.0000  3650.0000     2.0000  2007.0000</span></span>
<span><span class="co">#&gt;     3.0000    38.9000    17.8000   181.0000  3625.0000     1.0000  2007.0000</span></span>
<span><span class="co">#&gt;     3.0000    39.2000    19.6000   195.0000  4675.0000     2.0000  2007.0000</span></span>
<span><span class="co">#&gt;     3.0000    41.1000    17.6000   182.0000  3200.0000     1.0000  2007.0000</span></span>
<span><span class="co">#&gt; [ CPUFloatType{8,7} ]</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[2]]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt;  1</span></span>
<span><span class="co">#&gt;  1</span></span>
<span><span class="co">#&gt;  1</span></span>
<span><span class="co">#&gt;  1</span></span>
<span><span class="co">#&gt;  1</span></span>
<span><span class="co">#&gt;  1</span></span>
<span><span class="co">#&gt;  1</span></span>
<span><span class="co">#&gt;  1</span></span>
<span><span class="co">#&gt; [ CPULongType{8} ]</span></span></code></pre></div>
<p>To train a network, we can use <code><a href="https://coro.r-lib.org/reference/collect.html" class="external-link">coro::loop()</a></code> to iterate
over batches.</p>
<div class="section level3">
<h3 id="training-with-data-loaders">Training with data loaders<a class="anchor" aria-label="anchor" href="#training-with-data-loaders"></a>
</h3>
<p>Our example network is very simple. (In reality, we would want to
treat <code>island</code> as the categorical variable it is, and either
one-hot-encode or embed it.)</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">net</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/nn_module.html">nn_module</a></span><span class="op">(</span></span>
<span>  <span class="st">"PenguinNet"</span>,</span>
<span>  initialize <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">self</span><span class="op">$</span><span class="va">fc1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/nn_linear.html">nn_linear</a></span><span class="op">(</span><span class="fl">7</span>, <span class="fl">32</span><span class="op">)</span></span>
<span>    <span class="va">self</span><span class="op">$</span><span class="va">fc2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/nn_linear.html">nn_linear</a></span><span class="op">(</span><span class="fl">32</span>, <span class="fl">3</span><span class="op">)</span></span>
<span>  <span class="op">}</span>,</span>
<span>  forward <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">x</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>      <span class="va">self</span><span class="op">$</span><span class="fu">fc1</span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>      <span class="fu"><a href="../reference/nnf_relu.html">nnf_relu</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>      <span class="va">self</span><span class="op">$</span><span class="fu">fc2</span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>      <span class="fu"><a href="../reference/nnf_log_softmax.html">nnf_log_softmax</a></span><span class="op">(</span>dim <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">model</span> <span class="op">&lt;-</span> <span class="fu">net</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>We still need an optimizer:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">optimizer</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/optim_sgd.html">optim_sgd</a></span><span class="op">(</span><span class="va">model</span><span class="op">$</span><span class="va">parameters</span>, lr <span class="op">=</span> <span class="fl">0.01</span><span class="op">)</span></span></code></pre></div>
<p>And we’re ready to train:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">for</span> <span class="op">(</span><span class="va">epoch</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="va">l</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="fu">coro</span><span class="fu">::</span><span class="fu"><a href="https://coro.r-lib.org/reference/collect.html" class="external-link">loop</a></span><span class="op">(</span><span class="kw">for</span> <span class="op">(</span><span class="va">b</span> <span class="kw">in</span> <span class="va">dl</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">optimizer</span><span class="op">$</span><span class="fu">zero_grad</span><span class="op">(</span><span class="op">)</span></span>
<span>    <span class="va">output</span> <span class="op">&lt;-</span> <span class="fu">model</span><span class="op">(</span><span class="va">b</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span>    <span class="va">loss</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/nnf_nll_loss.html">nnf_nll_loss</a></span><span class="op">(</span><span class="va">output</span>, <span class="va">b</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span>    <span class="va">loss</span><span class="op">$</span><span class="fu">backward</span><span class="op">(</span><span class="op">)</span></span>
<span>    <span class="va">optimizer</span><span class="op">$</span><span class="fu">step</span><span class="op">(</span><span class="op">)</span></span>
<span>    <span class="va">l</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">l</span>, <span class="va">loss</span><span class="op">$</span><span class="fu">item</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"Loss at epoch %d: %3f\n"</span>, <span class="va">epoch</span>, <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">l</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="co">#&gt; Loss at epoch 1: 70255.275273</span></span>
<span><span class="co">#&gt; Loss at epoch 2: 2.068251</span></span>
<span><span class="co">#&gt; Loss at epoch 3: 2.068251</span></span>
<span><span class="co">#&gt; Loss at epoch 4: 2.068251</span></span>
<span><span class="co">#&gt; Loss at epoch 5: 2.068251</span></span>
<span><span class="co">#&gt; Loss at epoch 6: 2.068251</span></span>
<span><span class="co">#&gt; Loss at epoch 7: 2.068251</span></span>
<span><span class="co">#&gt; Loss at epoch 8: 2.068251</span></span>
<span><span class="co">#&gt; Loss at epoch 9: 2.068251</span></span>
<span><span class="co">#&gt; Loss at epoch 10: 2.068251</span></span></code></pre></div>
<p>Through this example we have trained a deep learning model using
<code><a href="../reference/dataset.html">dataset()</a></code> to define a custom class and then loaded it in
batches with a data loader. By using the dataset and data loader we were
able to write code that split the data preprocessing and setup from the
model training itself.</p>
</div>
</div>
<div class="section level2">
<h2 id="notes-on-efficiency">Notes on efficiency<a class="anchor" aria-label="anchor" href="#notes-on-efficiency"></a>
</h2>
<p>When using datasets and data loaders you may find that under certain
conditions your code is running more slowly than you’d expect. In some
situations the overhead of using dataloaders and datasets can impact
overall performance. This may change in time as the R/C++ integration of
Torch improves, but for now there are some workarounds:</p>
<div class="section level3">
<h3 id="use--getbatch-instead-of--getitem">Use <code>.getbatch()</code> instead of <code>.getitem()</code><a class="anchor" aria-label="anchor" href="#use--getbatch-instead-of--getitem"></a>
</h3>
<p>By default a dataloader will use the <code>.getitem()</code> member
function to pull each single datapoint individually. You can speed this
up by switching to using <code>.getbatch()</code> which will pull all
the datapoints in a batch at once:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">penguins_dataset_batching</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/dataset.html">dataset</a></span><span class="op">(</span></span>
<span>  </span>
<span>  name <span class="op">=</span> <span class="st">"penguins_dataset_batching"</span>,</span>
<span>  </span>
<span>  initialize <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">self</span><span class="op">$</span><span class="va">data</span> <span class="op">&lt;-</span> <span class="va">self</span><span class="op">$</span><span class="fu">prepare_penguin_data</span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="op">}</span>,</span>
<span>  </span>
<span>  <span class="co"># the only change is that this went from .getitem to .getbatch</span></span>
<span>  .getbatch <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">index</span><span class="op">)</span> <span class="op">{</span></span>
<span>    </span>
<span>    <span class="va">x</span> <span class="op">&lt;-</span> <span class="va">self</span><span class="op">$</span><span class="va">data</span><span class="op">[</span><span class="va">index</span>, <span class="fl">2</span><span class="op">:</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span></span>
<span>    <span class="va">y</span> <span class="op">&lt;-</span> <span class="va">self</span><span class="op">$</span><span class="va">data</span><span class="op">[</span><span class="va">index</span>, <span class="fl">1</span><span class="op">]</span><span class="op">$</span><span class="fu">to</span><span class="op">(</span><span class="fu"><a href="../reference/torch_dtype.html">torch_long</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span></span>
<span>  <span class="op">}</span>,</span>
<span>  </span>
<span>  .length <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">self</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="fu">size</span><span class="op">(</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span>  <span class="op">}</span>,</span>
<span>  </span>
<span>  prepare_penguin_data <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span>
<span>    </span>
<span>    <span class="va">input</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/na.fail.html" class="external-link">na.omit</a></span><span class="op">(</span><span class="va">penguins</span><span class="op">)</span> </span>
<span>    <span class="co"># conveniently, the categorical data are already factors</span></span>
<span>    <span class="va">input</span><span class="op">$</span><span class="va">species</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">species</span><span class="op">)</span></span>
<span>    <span class="va">input</span><span class="op">$</span><span class="va">island</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">island</span><span class="op">)</span></span>
<span>    <span class="va">input</span><span class="op">$</span><span class="va">sex</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">sex</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="va">input</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">input</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="../reference/torch_tensor.html">torch_tensor</a></span><span class="op">(</span><span class="va">input</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>In many instances the only change is to exactly replace just
<code>.getitem</code> with <code>.getbatch</code> since often the
<code>.getitem</code> function is written to handle vectors of indices.
In this penguins example the <code>.getitem</code> function used the
index to select the rows, which will work fine with a vector instead</p>
</div>
<div class="section level3">
<h3 id="remove-dataset-dataloader-and-manually-define-the-function-calls">Remove dataset dataloader and manually define the function
calls<a class="anchor" aria-label="anchor" href="#remove-dataset-dataloader-and-manually-define-the-function-calls"></a>
</h3>
<p>If switching to <code>.getbatch</code> does not provide the benefit
you were expecting you could also remove the <code>dataset</code>
entirely and manually pass the data. At this point you are trading
readability of your code and convenience for speed.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">input</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/na.fail.html" class="external-link">na.omit</a></span><span class="op">(</span><span class="va">penguins</span><span class="op">)</span> </span>
<span><span class="co"># conveniently, the categorical data are already factors</span></span>
<span><span class="va">input</span><span class="op">$</span><span class="va">species</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">species</span><span class="op">)</span></span>
<span><span class="va">input</span><span class="op">$</span><span class="va">island</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">island</span><span class="op">)</span></span>
<span><span class="va">input</span><span class="op">$</span><span class="va">sex</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">sex</span><span class="op">)</span></span>
<span></span>
<span><span class="va">input</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">input</span><span class="op">)</span></span>
<span><span class="va">input</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/torch_tensor.html">torch_tensor</a></span><span class="op">(</span><span class="va">input</span><span class="op">)</span></span>
<span></span>
<span><span class="va">data_x</span> <span class="op">&lt;-</span> <span class="va">input</span><span class="op">[</span>, <span class="fl">2</span><span class="op">:</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span></span>
<span><span class="va">data_y</span> <span class="op">&lt;-</span> <span class="va">input</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span><span class="op">$</span><span class="fu">to</span><span class="op">(</span><span class="fu"><a href="../reference/torch_dtype.html">torch_long</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">batch_size</span> <span class="op">&lt;-</span> <span class="fl">8</span></span>
<span><span class="va">num_data_points</span> <span class="op">&lt;-</span> <span class="va">data_y</span><span class="op">$</span><span class="fu">size</span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">num_batches</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">floor</a></span><span class="op">(</span><span class="va">num_data_points</span><span class="op">/</span><span class="va">batch_size</span><span class="op">)</span></span>
<span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">epoch</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span><span class="op">{</span></span>
<span></span>
<span>  <span class="co"># rearrange the data each epoch</span></span>
<span>  <span class="va">permute</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/torch_randperm.html">torch_randperm</a></span><span class="op">(</span><span class="va">num_data_points</span><span class="op">)</span> <span class="op">+</span> <span class="fl">1L</span></span>
<span>  <span class="va">data_x</span> <span class="op">&lt;-</span> <span class="va">data_x</span><span class="op">[</span><span class="va">permute</span><span class="op">]</span></span>
<span>  <span class="va">data_y</span> <span class="op">&lt;-</span> <span class="va">data_y</span><span class="op">[</span><span class="va">permute</span><span class="op">]</span></span>
<span>  </span>
<span>  <span class="co"># manually loop through the batches</span></span>
<span>  <span class="kw">for</span><span class="op">(</span><span class="va">batch_idx</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">num_batches</span><span class="op">)</span><span class="op">{</span></span>
<span></span>
<span>    <span class="co"># here index is a vector of the indices in the batch</span></span>
<span>    <span class="va">index</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">batch_size</span><span class="op">*</span><span class="op">(</span><span class="va">batch_idx</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span><span class="op">:</span><span class="op">(</span><span class="va">batch_idx</span><span class="op">*</span><span class="va">batch_size</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="va">x</span> <span class="op">&lt;-</span> <span class="va">data_x</span><span class="op">[</span><span class="va">index</span><span class="op">]</span></span>
<span>    <span class="va">y</span> <span class="op">&lt;-</span> <span class="va">data_y</span><span class="op">[</span><span class="va">index</span><span class="op">]</span><span class="op">$</span><span class="fu">to</span><span class="op">(</span><span class="fu"><a href="../reference/torch_dtype.html">torch_long</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span>    <span class="va">optimizer</span><span class="op">$</span><span class="fu">zero_grad</span><span class="op">(</span><span class="op">)</span></span>
<span>    <span class="va">output</span> <span class="op">&lt;-</span> <span class="fu">model</span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span>    <span class="va">loss</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/nnf_nll_loss.html">nnf_nll_loss</a></span><span class="op">(</span><span class="va">output</span>, <span class="va">y</span><span class="op">)</span></span>
<span>    <span class="va">loss</span><span class="op">$</span><span class="fu">backward</span><span class="op">(</span><span class="op">)</span></span>
<span>    <span class="va">optimizer</span><span class="op">$</span><span class="fu">step</span><span class="op">(</span><span class="op">)</span></span>
<span>    <span class="va">l</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">l</span>, <span class="va">loss</span><span class="op">$</span><span class="fu">item</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"Loss at epoch %d: %3f\n"</span>, <span class="va">epoch</span>, <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">l</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Daniel Falbel, Javier Luraschi.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
